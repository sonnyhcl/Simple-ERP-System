{% extends "base.html" %}
{% block title %}首页{% endblock %}
{%  set selected_menu = "index" %}

{% block content %}
<div class="container">
    <!-- 个人信息展板 -->
    <div class="jumbotron">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="col-md-4 column">
                    <img alt="头像" src="{{ session['big_icon'] }}">
                </div>
                <div class="col-md-4 column">
                    <form class="form-horizontal" role="form">
                        <p>姓名: {{ session['u_name'] }}</p>
                        <p>社区: {{ session['c_id'] }}</p>
                    </form>
                </div>
                <div class="col-md-4 column">
                    <form class="form-horizontal" role="form">
                        <p>手机: {{ session['u_role'] }}</p>
                        <p>角色: {{ session['logged_in'] }}</p>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- 时间筛选器-->
    <div align="center">
        从<input type="month" value="2017-01">到<input type="month" value="2017-01">
    </div>
    <!-- 个人流水表格 -->
    <table class="table table-bordered table-striped table-hover" cellspacing="0"
           id="i_table" width="100%">
    </table>
</div>

{% endblock content %}

{% block script %}
{{ super() }}

<script type="text/javascript">
    $(document).ready(function () {
        var doc_table;
        console.log('document ready');
        $.post('/user/page/',
            function (ret) {
                doc_table = $('#i_table').dataTable({
                    "aoColumns": [
                        {"sTitle": "社区"},
                        {"sTitle": "姓名"},
                        {"sTitle": "身份"},
                        {"sTitle": "联系方式"},
                        {
                            "width": "12%",
                            "sTitle": "操作",
                            "bSortable": false
                        }
                    ],
                    "oLanguage": {
                        "oPaginate": {
                            "sPrevious": "上一页",
                            "sNext": "下一页",
                            "sFirst": "第一页",
                            "sLast": "最后一页"
                        },
                        "sZeroRecords": "似乎来到了一块没有数据的荒原...",
                        "sInfo": "共 _PAGES_ 页，从第 _START_ 到第 _END_ 页，共 _TOTAL_ 条 (只显示最近的100条流水)",
                        "sInfoEmpty": "0 条记录",
                        "sInfoFiltered": "",
                        "sLengthMenu": "显示 _MENU_ 条",
                        "sSearch": "搜索",
                        "sProcessing": "正在获取数据，请稍等..."
                    },
                    "bSort": true,
                    "bPaginate": true,
                    "sPaginationType": "full",
                    "sPageButton": "",
                    "bAutoWidth": true,
                    "bScrollCollapse": true,
                    "bStateSave": true
                });
                var members = ret.data;
                for (var ij in members) {
                    doc_table.fnAddData([
                        members[ij].c_name,
                        members[ij].u_name,
                        members[ij].u_role,
                        members[ij].u_phone,
                        "<button href='#alterUser' data-toggle='modal' onclick='modify_it(" +
                        members[ij].u_id + ")' class='btn btn-default' type='button'>修改</button>" + "  " +
                        "<button href='#confirmDeleteModal' data-toggle='modal' onclick='delete_it( " +
                        members[ij].u_id + ")' class='btn btn-danger' type='button'>删除</button>"
                    ])
                }
            }, 'json');
    });
</script>
{% endblock script %}
